{
  "version": 3,
  "sources": ["main.ts"],
  "sourcesContent": ["\"use strict\"\n\nimport * as electron from 'electron'\nimport * as path from 'path'\nimport * as fs from 'fs'\n\n// ******************************** \u52A0\u8F7D\u6A21\u5757 ********************************\n\nconst {app, Menu, BrowserWindow, ipcMain, dialog, shell} = electron\nconst Path = path\n\n// ******************************** \u6CE8\u518C\u4E8B\u4EF6 ********************************\n\n// \u51C6\u5907\u5B8C\u6BD5\napp.on('ready', () => {\n  createEditorMenu()\n  createEditorWindow()\n})\n\n// \u7A97\u53E3\u5168\u90E8\u5173\u95ED\u540E\u9000\u51FA\u5E94\u7528\napp.on('window-all-closed', () => {\n  app.quit()\n})\n\n// ******************************** \u521B\u5EFA\u7F16\u8F91\u5668\u83DC\u5355\u680F ********************************\n\nconst removeFullScreenMenu = function (template) {\n  for (let i = 0; i < template.length; i++) {\n    let item = template[i]\n    if (item.label === 'Menu') {\n      for (let j = 0; j < item.submenu.length; j++) {\n        const subItem = item.submenu[j]\n        if (process.platform === 'darwin' && subItem.label === 'FullScreen') {\n          item.submenu.splice(j, j)\n          return template\n        }\n      }\n    }\n  }\n  return template\n}\n\nconst createEditorMenu = function () {\n  // \u521B\u5EFA\u6A21\u677F\n  let template = [\n    {\n      label: 'Menu',\n      submenu: [\n        { label: 'Reload', accelerator: 'F5', role: 'forceReload', },\n        { label: 'FullScreen', accelerator: 'F11', role: 'toggleFullScreen', },\n        { label: 'Toogle DevTools', accelerator: 'F12', role: 'toggleDevTools', }\n      ],\n    },\n    {\n      label: 'Edit',\n      submenu: [\n        { label: 'Cut', accelerator: 'CmdOrCtrl+X', role: 'cut', },\n        { label: 'Copy', accelerator: 'CmdOrCtrl+C', role: 'copy', },\n        { label: 'Paste', accelerator: 'CmdOrCtrl+V', role: 'paste', },\n        { label: 'SelectAll', accelerator: 'CmdOrCtrl+A', role: 'selectAll', }\n      ],\n    }\n  ]\n\n  // \u5173\u95EDmacOS\u4E0A\u7A97\u53E3\u5706\u89D2, \u8FDB\u5165\u5168\u5C4F\u6A21\u5F0F\u4F1Acrash\n  // macOS\u4E0B\u53D6\u6D88\u5168\u5C4F\u6A21\u5F0F\u9009\u9879\n  template = removeFullScreenMenu(template)\n\n  // \u8BBE\u7F6E\u83DC\u5355\n  const menu = Menu.buildFromTemplate(template)\n  Menu.setApplicationMenu(menu)\n}\n\n// ******************************** \u521B\u5EFA\u7F16\u8F91\u5668\u7A97\u53E3 ********************************\n\nconst createEditorWindow = function () {\n  // \u521B\u5EFA\u7A97\u53E3\n  const editor = new BrowserWindow({\n    title: 'Yami RPG Editor',\n    width: 1280,\n    height: 800,\n    useContentSize: true,\n    backgroundColor: 'white',\n    frame: false,\n    roundedCorners: false, // \u5173\u95EDmacOS\u4E0A\u7A97\u53E3\u5706\u89D2\n    hasShadow: false, // \u5173\u95ED\u7A97\u53E3\u9634\u5F71\n    show: false,\n    webPreferences: {\n      nodeIntegration: true,\n      contextIsolation: false,\n      spellcheck: false,\n    },\n  })\n\n  // \u9690\u85CF\u83DC\u5355\u680F\n  editor.setMenuBarVisibility(false)\n\n  // \u52A0\u8F7D\u6587\u4EF6\n  editor.loadFile(Path.resolve(__dirname, 'index.html'))\n\n  // \u4FA6\u542C\u7A97\u53E3\u6A21\u5F0F\u5207\u6362\u4E8B\u4EF6\n  editor.on('maximize', event => editor.send('maximize'))\n  editor.on('unmaximize', event => editor.send('unmaximize'))\n  editor.on('enter-full-screen', event => editor.send('enter-full-screen'))\n  editor.on('leave-full-screen', event => editor.send('leave-full-screen'))\n\n  // \u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6\u5E76\u8BBE\u7F6E\u7F29\u653E\u7CFB\u6570\n  const path = Path.resolve(__dirname, 'config.json')\n  const promise = fs.promises.readFile(path)\n  editor.once('ready-to-show', event => {\n    // \u7A97\u53E3\u6700\u5927\u5316\n    editor.maximize()\n    // \u6FC0\u6D3B\n    editor.show()\n    promise.then(config => {\n      editor.webContents.setZoomFactor(JSON.parse(config).zoom)\n      // \u6253\u5F00\u8C03\u8BD5\u5668\n      editor.webContents.openDevTools({mode: 'bottom'})\n    })\n  })\n\n  // \u4FA6\u542C\u7A97\u53E3\u5173\u95ED\u4E8B\u4EF6\n  editor.on('close', event => {\n    if (!editor.stopCloseEvent) {\n      editor.send('close')\n      event.preventDefault()\n    }\n  })\n}\n\n// ******************************** \u521B\u5EFA\u64AD\u653E\u5668\u7A97\u53E3 ********************************\n\nconst createPlayerWindow = function (parent, path) {\n  // \u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6\n  // const fs = require('fs')\n  const window = JSON.parse(fs.readFileSync(`${path}data/config.json`)).window\n\n  // \u51CF\u53BB\u83DC\u5355\u680F\u7684\u9AD8\u5EA6\n  if (process.platform === 'win32') {\n    window.height = Math.max(window.height - 20, 0)\n  }\n\n  // \u521B\u5EFA\u7A97\u53E3\n  const player = new BrowserWindow({\n    icon: `${path}Icon/icon.png`,\n    title: window.title,\n    width: window.width,\n    height: window.height,\n    backgroundColor: '#000000',\n    useContentSize: true,\n    show: false,\n    webPreferences: {\n      nodeIntegration: true,\n      contextIsolation: false,\n      spellcheck: false,\n      additionalArguments: ['--debug-mode'],\n    },\n  })\n\n  // \u8BBE\u7F6E\u7A97\u53E3\u6A21\u5F0F\n  switch (window.display) {\n    case 'window':\n      player.show()\n      break\n    case 'maximized':\n      player.maximize()\n      break\n    case 'fullscreen':\n      player.setFullScreen(true)\n      player.show()\n      break\n  }\n\n  // \u9690\u85CF\u83DC\u5355\u680F\n  player.setMenuBarVisibility(false)\n\n  // \u52A0\u8F7D\u9875\u9762\u6587\u4EF6\n  player.loadFile(`${path}index.html`)\n\n  // \u4FA6\u542C\u7A97\u53E3\u5173\u95ED\u4E8B\u4EF6\n  player.once('closed', () => {\n    if (!parent.isDestroyed()) {\n      parent.send('player-window-closed')\n    }\n  })\n}\n\n// ******************************** \u8FDB\u7A0B\u901A\u4FE1 ********************************\n\n// \u83B7\u53D6\u4E8B\u4EF6\u6765\u6E90\u7A97\u53E3\nconst getWindowFromEvent = function (event) {\n  return BrowserWindow.fromWebContents(event.sender)\n}\n\n// \u6700\u5C0F\u5316\u7A97\u53E3\nipcMain.on('minimize-window', event => {\n  const window = getWindowFromEvent(event)\n  if (window.isMinimized()) {\n    window.restore()\n  } else {\n    window.minimize()\n  }\n})\n\n// \u6700\u5927\u5316\u7A97\u53E3\nipcMain.on('maximize-window', event => {\n  const window = getWindowFromEvent(event)\n  if (!window.isFullScreen()) {\n    if (window.isMaximized()) {\n      window.unmaximize()\n    } else {\n      window.maximize()\n    }\n  }\n})\n\n// \u5173\u95ED\u7A97\u53E3\nipcMain.on('close-window', event => {\n  const window = getWindowFromEvent(event)\n  window.close()\n})\n\n// \u5F3A\u5236\u5173\u95ED\u7A97\u53E3\nipcMain.on('close-window-force', event => {\n  const window = getWindowFromEvent(event)\n  window.stopCloseEvent = true\n  window.close()\n})\n\n// \u5F00\u5173\u5168\u5C4F\u6A21\u5F0F\nipcMain.on('toggle-full-screen', event => {\n  const window = getWindowFromEvent(event)\n  window.setFullScreen(!window.isFullScreen())\n})\n\n// \u6253\u5F00\u8D44\u6E90\u7BA1\u7406\u5668\u8DEF\u5F84\nipcMain.on('open-path', (event, path) => {\n  shell.openPath(Path.normalize(path))\n})\n\n// \u5728\u8D44\u6E90\u7BA1\u7406\u5668\u4E2D\u663E\u793A\nipcMain.on('show-item-in-folder', (event, path) => {\n  shell.showItemInFolder(Path.normalize(path))\n})\n\n// \u521B\u5EFA\u64AD\u653E\u5668\u7A97\u53E3\nipcMain.on('create-player-window', (event, path) => {\n  const window = getWindowFromEvent(event)\n  createPlayerWindow(window, path)\n})\n\n// \u66F4\u65B0\u6700\u5927\u5C0F\u5316\u56FE\u6807\nipcMain.handle('update-max-min-icon', event => {\n  const window = getWindowFromEvent(event)\n  return window.isMaximized()  ? 'maximize'\n       : window.isFullScreen() ? 'enter-full-screen'\n       :                         'unmaximize'\n})\n\n// \u663E\u793A\u6253\u5F00\u5BF9\u8BDD\u6846\nipcMain.handle('show-open-dialog', (event, options) => {\n  const window = getWindowFromEvent(event)\n  return dialog.showOpenDialog(window, options)\n})\n\n// \u663E\u793A\u4FDD\u5B58\u5BF9\u8BDD\u6846\nipcMain.handle('show-save-dialog', (event, options) => {\n  const window = getWindowFromEvent(event)\n  return dialog.showSaveDialog(window, options)\n})\n\n// \u628A\u6587\u4EF6\u6254\u8FDB\u56DE\u6536\u7AD9\nipcMain.handle('trash-item', (event, path) => {\n  return shell.trashItem(Path.normalize(path))\n})\n\n// \u83B7\u53D6\u7528\u6237\u6587\u6863\u8DEF\u5F84\nipcMain.handle('get-documents-path', event => {\n  return app.getPath('documents')\n})"],
  "mappings": "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",
  "names": ["path"]
}
